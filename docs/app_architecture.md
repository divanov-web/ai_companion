# Архитектура приложения

Цель: маленькое приложение с ясными слоями и минимумом абстракций.

## Оглавление
- [Общая архитектура](./architecture_overall.md)
- [Слой Service](../internal/service/readme.md)
- [Слой Adapter](../internal/adapter/readme.md)
- [Слой сценариев(приложений) App](../internal/app/readme.md)

## Термины
- Сообщение — один запрос/ответ в Responses API.
- Диалог — цепочка сообщений с общим контекстом, связанная `conversation`.

## Слои
1. `cmd/companion` — сборка зависимостей и запуск сценария.
2. `internal/service` — оркестрация сценариев: создать/продолжить диалог, отправить текст, отправить текст+картинку.
3. `internal/adapter` — адаптер OpenAI: формирует параметры SDK и вызывает OpenAI API.
4. `internal/service/tts` — слой синтеза речи (интерфейс + реализации провайдеров). Сейчас подключён провайдер Yandex.

## Правила проектирования
- Зависимости собирать вручную на верхнем уровне.
- Интерфейсы вводить когда больше 1 реализации какой-нибудь сущности.
- Unit тесты пока что писать не надо
- Конфигурация провайдера TTS берётся из `.env`/ENV/флагов; ключ обязателен (`YC_TTS_API_KEY`).
  - Как задать `YC_TTS_API_KEY` (любой способ, приоритет от низшего к высшему):
    1) Запись в `.env` в корне проекта
    2) Переменная окружения ОС
    3) Флаг запуска: `-yc-tts-api-key <KEY>`
- Проигрывание аудио происходит сразу после синтеза, без сохранения файлов (поддержка mp3/wav).
- Параметры Yandex TTS: `YC_TTS_VOICE` (по умолчанию `ermil`), `YC_TTS_FORMAT` (по умолчанию `mp3`), `YC_TTS_SPEED` (по умолчанию `1.3` — ускорение примерно на 30%), `YC_TTS_EMOTION` (по умолчанию `evil`).

## Правила OpenAI
- Используем Responses API; Chat Completions считать устаревшим.
- Диалог создаётся через `Conversations` и далее продолжается передачей `conversation.ID` в запросы.

## Правила оформления кода
- Писать очень короткие комментарии к каждому методу и импортируемой структуре.

## Следующие шаги
- Добавить альтернативные реализации TTS (по интерфейсу `internal/service/tts`).
- Расширить конфиг TTS (скорость, язык, эмоция) при необходимости.
